# Copyright (C) 2016-present Arctic Ice Studio <development@arcticicestudio.com>
# Copyright (C) 2016-present Sven Greb <development@svengreb.de>

# Project:    igloo
# Repository: https://github.com/arcticicestudio/igloo
# License:    MIT
# References:
#   https://git-scm.com/docs/git-mergetool

# When using IntelliJ as `mergetool` and setting `mergetool.intellij.trustExitCode` to `true`,
# the `mergetool.intellij.cmd` gets called for all files immediately.
# After IntelliJ gets closed for the first processed file, all other calls will error because
# the temporary files passed to `idea merge`as parameters are not valid anymore causing the app
# to exit.
#
# The problem is that Git is not able to interpret or track started IntelliJ process and fails
# to listen for the exit code, causing the calls to be fired immediately.
# This problem can be narrowed down to macOS while it works fine for Linux systems.
# See https://git-scm.com/docs/git-mergetool for more details.
#
# To fix the problem `trustExitCode` option is set to `false` an `prompt` to `true` to force Git
# to wait for the user to confirm the merge is completed and the app window has been closed before
# continuing with the next queued file.
# The only impact is that it requires to press `y` or `n` after solving a conflict instead of only
# closing the app window and waiting for it to reopen again for the next file.
# This is also limited to macOS so the impact is very small compared to the broken state when not
# applying the fix.
#
# In order to dynamically apply the configuration file only for macOS systems , this file is loaded
# through a `[include]` block in the main Git configuration file and only linked by "snowsaw" for
# macOS based hosts.
#
# See https://github.com/arcticicestudio/igloo/issues/206 for more details.
[mergetool "intellij"]
  prompt = true
  trustExitCode = false
